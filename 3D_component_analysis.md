# –ê–Ω–∞–ª–∏–∑ 3D —Å–æ—Å—Ç–∞–≤–ª—è—é—â–µ–π –ø—Ä–æ–µ–∫—Ç–∞ Rogue

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏ –∫–∞–º–µ—Ä—ã**
   * –í `MovementHandler.handle_3d_movement()` —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π –∫–∞–º–µ—Ä—ã, –Ω–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –¥–ª—è –∏–≥—Ä–æ–≤–æ–π –ª–æ–≥–∏–∫–∏
   * `camera.grid_position` –º–æ–∂–µ—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `character.position` –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
   * –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞—Ç–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
2. **Z-buffer –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –¥–≤–µ—Ä–µ–π**
   * –î–≤–µ—Ä–∏ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ —Å—Ç–µ–Ω—ã, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è—é—Ç Z-buffer
   * –û—Ç–∫—Ä—ã—Ç—ã–µ/–∑–∞–∫—Ä—ã—Ç—ã–µ –¥–≤–µ—Ä–∏ –≤–∏–∑—É–∞–ª—å–Ω–æ –Ω–µ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è –≤ 3D
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è**
   * –ù–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (–¥–≤–µ—Ä–∏, –ø—Ä–µ–¥–º–µ—Ç—ã) –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
   * Reticle –º–µ–Ω—è–µ—Ç —Ü–≤–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—Ä–∞–≥–æ–≤, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –¥—Ä—É–≥–∏–µ –æ–±—ä–µ–∫—Ç—ã
4. **–ü—Ä–æ–±–ª–µ–º—ã —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∫–∞–º–µ—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ**
   * `ViewManager.apply_camera_state()` –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∫–∞–º–µ—Ä—É, –Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –Ω–µ –≤—Å–µ–≥–¥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   * –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –∫–∞–º–µ—Ä—ã (–º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Å—Ç–µ–Ω–µ)

### üü° –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

5. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–π–∫–∞—Å—Ç–∏–Ω–≥**
   * –ö–∞–∂–¥—ã–π –∫–∞–¥—Ä —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã `RayHit`
   * –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω–æ–π –≥–µ–æ–º–µ—Ç—Ä–∏–∏
   * `cast_fov_rays()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä –¥–∞–∂–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è
6. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ–∫—Å—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º**
   * –¢–µ–∫—Å—Ç—É—Ä—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ —Å—Ç–µ–Ω–∞–º, –∫–æ—Ä–∏–¥–æ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —É–ø—Ä–æ—â–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
   * –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ä–∞–∑–ª–∏—á–∏–µ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ —Å—Ç–µ–Ω (–∫–æ–º–Ω–∞—Ç—ã vs –∫–æ—Ä–∏–¥–æ—Ä—ã)
   * –î–≤–µ—Ä–∏ –Ω–µ –∏–º–µ—é—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–µ–∫—Å—Ç—É—Ä –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤
7. **–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è F/Space**
   * `_handle_3d_interact()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –±–ª–∏–∂–∞–π—à–∏–π –æ–±—ä–µ–∫—Ç
   * –ï—Å–ª–∏ –ø–µ—Ä–µ–¥ –¥–≤–µ—Ä—å—é —Å—Ç–æ–∏—Ç –≤—Ä–∞–≥, –¥–≤–µ—Ä—å –Ω–µ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è
   * –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —è–≤–Ω–æ
8. **–ú–∏–Ω–∏–∫–∞—Ä—Ç–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –∫–∞–º–µ—Ä—ã**
   * –ü–æ–∑–∏—Ü–∏—è –∏–≥—Ä–æ–∫–∞ –Ω–∞ –º–∏–Ω–∏–∫–∞—Ä—Ç–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è
   * –ü—Ä–∏ –≤—Ä–∞—â–µ–Ω–∏–∏ –∫–∞–º–µ—Ä—ã —Å—Ç—Ä–µ–ª–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–∂–µ—Ç –æ—Ç—Å—Ç–∞–≤–∞—Ç—å

### üü¢ –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

9. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–ª–∞–≤–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤**
   * –î–≤–∏–∂–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã –¥–∏—Å–∫—Ä–µ—Ç–Ω–æ–µ (–Ω–∞ —Ü–µ–ª—É—é –∫–ª–µ—Ç–∫—É)
   * –ù–µ—Ç –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –ø—Ä–∏ –ø–æ–≤–æ—Ä–æ—Ç–µ
   * –†–µ–∑–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏
10. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å**
    * –ù–µ—Ç –∑–≤—É–∫–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (–ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
    * –°–ª–∞–±–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —É—Ä–æ–Ω–∞ –≤ 3D —Ä–µ–∂–∏–º–µ
    * `CombatFeedback` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–≤–µ—Ä—Ö—É, –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ 3D –≤–∏–¥
11. **–ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ –±–æ–ª—å—à–∏—Ö —É—Ä–æ–≤–Ω—è—Ö**
    * –°–ø—Ä–∞–π—Ç—ã –≤—Å–µ—Ö –≤—Ä–∞–≥–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä
    * –ù–µ—Ç culling –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ –≤–Ω–µ FOV –¥–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    * –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏ –ø–æ –≤—Å–µ–º –∫–æ–º–Ω–∞—Ç–∞–º –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤
12. **–ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è**
    * `move_speed=0.3` –≤ `CameraController`, –Ω–æ –ø–µ—Ä—Å–æ–Ω–∞–∂ –¥–≤–∏–≥–∞–µ—Ç—Å—è –Ω–∞ —Ü–µ–ª—ã–µ –∫–ª–µ—Ç–∫–∏
    * `collision_radius=0.25` –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    * –†–∞–∑–ª–∏—á–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (float –¥–ª—è –∫–∞–º–µ—Ä—ã, int –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞)

---

## –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç HIGH)

#### 1.1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø–æ–∑–∏—Ü–∏–π

 **–§–∞–π–ª—ã** : `domain/services/movement_handler.py`, `presentation/camera/sync.py`

```python
# –í MovementHandler.handle_3d_movement():
# –ë–´–õ–û:
new_x, new_y = session.camera.grid_position
session.character.move_to(new_x, new_y)

# –î–û–õ–ñ–ù–û –ë–´–¢–¨:
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –∫–∞–º–µ—Ä—ã —Å —É—á–µ—Ç–æ–º offset
final_x = round(session.camera.x)
final_y = round(session.camera.y)

# –í–∞–ª–∏–¥–∞—Ü–∏—è: –ø–æ–∑–∏—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ—Ö–æ–¥–∏–º–æ–π –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
if not session.level.is_walkable(final_x, final_y):
    # –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã
    session.camera_controller.set_position(
        session.character.position[0] + 0.5,
        session.character.position[1] + 0.5
    )
    session.message = "Can't move there - blocked!"
    return False

session.character.move_to(final_x, final_y)
```

 **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ CameraSync** :

```python
def validate_and_sync(self, camera, character, level):
    """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –∫–∞–º–µ—Ä—É –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π."""
    grid_x, grid_y = self.get_camera_grid_position(camera)
  
    if not level.is_walkable(grid_x, grid_y):
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–º–µ—Ä—É –∫ –ø–µ—Ä—Å–æ–Ω–∞–∂—É
        self.sync_camera_to_character(camera, character, preserve_angle=True)
        return False
  
    character.move_to(grid_x, grid_y)
    return True
```

#### 1.2. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤–µ—Ä–µ–π –≤ 3D

 **–§–∞–π–ª—ã** : `presentation/rendering/raycasting.py`, `presentation/renderer_3d.py`

```python
# –í _determine_wall_type():
def _determine_wall_type(level, x: int, y: int) -> tuple[str, Any]:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (wall_type, door_object)."""
    door = level.get_door_at(x, y)
    if door:
        # –†–∞–∑–ª–∏—á–∞–µ–º locked/unlocked –¥–≤–µ—Ä–∏
        return ('door_locked' if door.is_locked else 'door_open', door)
  
    # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
    return ('room_wall', None)

# –í Renderer3D –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç—É—Ä—ã –¥–ª—è –¥–≤–µ—Ä–µ–π:
def _render_wall_column(self, column, hit, x_offset, y_offset):
    # ...
    if hit.wall_type.startswith('door'):
        # –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤–µ—Ä–µ–π
        if hit.wall_type == 'door_locked':
            color = get_key_door_color(hit.door_object.color)
            char = '‚ñà'  # locked
        else:
            char = '‚ñë'  # open
            color = COLOR_CORRIDOR
```

#### 1.3. –£–ª—É—á—à–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—É—é –∏–Ω–¥–∏–∫–∞—Ü–∏—é

 **–§–∞–π–ª—ã** : `presentation/ui/combat_feedback.py`

```python
class TargetingReticle:
    def set_target(self, entity_type, entity=None):
        """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–∏–ø —Ü–µ–ª–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è reticle."""
        self.target_type = entity_type  # 'enemy', 'item', 'door', 'exit'
        self.target_entity = entity
      
    def render(self, viewport_width, viewport_height, x_offset=0, y_offset=0):
        # –†–∞–∑–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤
        reticle_chars = {
            'enemy': '‚ï¨',     # –≤—Ä–∞–≥
            'item': '‚óé',      # –ø—Ä–µ–¥–º–µ—Ç
            'door': '‚ñ£',      # –¥–≤–µ—Ä—å
            'exit': '‚ñ∫',      # –≤—ã—Ö–æ–¥
            None: '¬∑'         # –Ω–∏—á–µ–≥–æ
        }
      
        # –†–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞
        colors = {
            'enemy': curses.color_pair(7) | curses.A_BOLD,  # –∫—Ä–∞—Å–Ω—ã–π
            'item': curses.color_pair(4),                    # cyan
            'door': curses.color_pair(9),                    # yellow
            'exit': curses.color_pair(5),                    # magenta
            None: curses.color_pair(1) | curses.A_DIM
        }
```

#### 1.4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã

 **–§–∞–π–ª—ã** : `presentation/view_manager.py`, `data/save_manager.py`

```python
# –í ViewManager.apply_camera_state():
def apply_camera_state(self, camera_state: Optional[dict], level: Any) -> bool:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ, False –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å."""
    if camera_state is None or self._camera_factory is None:
        return False
  
    x, y = camera_state.get('x', 0.0), camera_state.get('y', 0.0)
  
    # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–æ–∑–∏—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞
    grid_x, grid_y = int(x), int(y)
    if not level.is_walkable(grid_x, grid_y):
        # –ò—â–µ–º –±–ª–∏–∂–∞–π—à—É—é –≤–∞–ª–∏–¥–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
        for dx, dy in [(0,0), (1,0), (-1,0), (0,1), (0,-1)]:
            test_x, test_y = grid_x + dx, grid_y + dy
            if level.is_walkable(test_x, test_y):
                x, y = test_x + 0.5, test_y + 0.5
                break
        else:
            return False  # –ù–µ—Ç –≤–∞–ª–∏–¥–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
  
    # –°–æ–∑–¥–∞–µ–º –∫–∞–º–µ—Ä—É
    try:
        self.camera = self._camera_factory(x, y, 
            camera_state.get('angle', 0.0),
            camera_state.get('fov', 60.0))
      
        if self._camera_controller_factory:
            self.camera_controller = self._camera_controller_factory(
                self.camera, level)
      
        return True
    except Exception as exc:
        log_exception(exc, __name__)
        return False
```

---

### –§–∞–∑–∞ 2: –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç MEDIUM)

#### 2.1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–π–∫–∞—Å—Ç–∏–Ω–≥–∞

 **–§–∞–π–ª—ã** : `presentation/renderer_3d.py`

```python
class Renderer3D:
    def __init__(self, ...):
        # ...
        self._ray_cache = {}
        self._last_camera_state = None
      
    def render_3d_view(self, camera, level, fog_of_war=None, ...):
        # –ö—ç—à –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–∑–∏—Ü–∏–∏ –∏ —É–≥–ª–∞ –∫–∞–º–µ—Ä—ã
        camera_state = (
            int(camera.x * 10), int(camera.y * 10), 
            int(camera.angle)
        )
      
        if camera_state == self._last_camera_state and self._ray_cache:
            ray_hits = self._ray_cache
        else:
            ray_hits = cast_fov_rays(camera, level, num_rays=self.num_rays)
            self._ray_cache = ray_hits
            self._last_camera_state = camera_state
      
        # ... rest of rendering
```

#### 2.2. –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—É—Ä—ã –∏ –¥–≤–µ—Ä–∏

 **–§–∞–π–ª—ã** : `presentation/rendering/texture_system.py`

```python
# –í TextureManager._create_default_textures():
# –î–æ–±–∞–≤–∏—Ç—å —Ü–≤–µ—Ç–Ω—ã–µ —Ç–µ–∫—Å—Ç—É—Ä—ã –¥–≤–µ—Ä–µ–π
for color in KeyColor:
    locked_pattern = self._create_door_texture(color, locked=True)
    open_pattern = self._create_door_texture(color, locked=False)
  
    self.textures[f'door_{color.value}_locked'] = WallTexture(...)
    self.textures[f'door_{color.value}_open'] = WallTexture(...)

def _create_door_texture(self, color, locked=True):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç—É—Ä—É –¥–≤–µ—Ä–∏ —Å —É—á–µ—Ç–æ–º —Ü–≤–µ—Ç–∞."""
    if locked:
        return [
            "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó",
            "‚ïë‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ïë",
            "‚ïë‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ïë",
            "‚ïë‚ñì‚ñì   ‚ñì‚ñì‚ïë",
            f"‚ïë‚ñì‚ñì {self._get_lock_symbol(color)} ‚ñì‚ñì‚ïë",
            "‚ïë‚ñì‚ñì   ‚ñì‚ñì‚ïë",
            "‚ïë‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ïë",
            "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù",
        ]
    else:
        # –û—Ç–∫—Ä—ã—Ç–∞—è –¥–≤–µ—Ä—å - –±–æ–ª–µ–µ –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è
        return [...]
```

#### 2.3. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

 **–§–∞–π–ª—ã** : `domain/services/action_processor.py`

```python
def _handle_3d_interact(self):
    """–£–º–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏."""
    if not self.session.camera_controller:
        return False
  
    entity, entity_type, distance = \
        self.session.camera_controller.get_entity_in_front(self.session.level)
  
    # –ü–†–ò–û–†–ò–¢–ï–¢–´ (–æ—Ç –≤—ã—Å–æ–∫–æ–≥–æ –∫ –Ω–∏–∑–∫–æ–º—É):
    # 1. –î–≤–µ—Ä–∏ (–≤—Å–µ–≥–¥–∞ –ø—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å –ø–µ—Ä–≤—ã–º–∏)
    door_success, door_msg = \
        self.session.camera_controller.try_open_door(self.session.character)
    if door_success or door_msg != "No door nearby":
        self.session.message = door_msg
        return door_success
  
    # 2. –í—Ä–∞–≥–∏ (–∞—Ç–∞–∫–∞)
    if entity_type == 'enemy':
        return self._handle_3d_attack()
  
    # 3. –ü—Ä–µ–¥–º–µ—Ç—ã (–ø–æ–¥–±–æ—Ä)
    if entity_type == 'item':
        return self._handle_3d_pickup()
  
    # 4. –í—ã—Ö–æ–¥ (–ø—Ä–æ—Ö–æ–¥)
    if entity_type == 'exit':
        return self.session.handle_movement('forward')
  
    # 5. –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
    self.session.message = "Nothing to interact with"
    return False
```

#### 2.4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∏–Ω–∏–∫–∞—Ä—Ç—ã

 **–§–∞–π–ª—ã** : `presentation/rendering/minimap_renderer.py`

```python
class MiniMapRenderer:
    def __init__(self, ...):
        # ...
        self._last_camera_angle = None
      
    def render_minimap(self, stdscr, level, camera, ...):
        # –î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É–≥–ª–∞
        if camera.angle != self._last_camera_angle:
            self._invalidate_cache()
            self._last_camera_angle = camera.angle
      
        # ... rest of rendering
```

---

### –§–∞–∑–∞ 3: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç LOW)

#### 3.1. –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

 **–§–∞–π–ª—ã** : `presentation/camera/controller.py`

```python
class CameraController:
    def __init__(self, ...):
        # ...
        self.smooth_movement = False  # –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π
        self._target_position = None
        self._interpolation_steps = 5
      
    def move_forward(self):
        if self.smooth_movement:
            # –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—é
            target_x, target_y = self.camera.move_forward(self.move_speed)
            self._start_interpolation(target_x, target_y)
            return True
        else:
            # –û–±—ã—á–Ω–æ–µ –¥–∏—Å–∫—Ä–µ—Ç–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
            return self._try_move(*self.camera.move_forward(self.move_speed))
```

#### 3.2. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

 **–§–∞–π–ª—ã** : `presentation/ui/combat_feedback.py`

```python
# –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—É—á–µ–Ω–∏—è —É—Ä–æ–Ω–∞ –≤ —Ü–µ–Ω—Ç—Ä —ç–∫—Ä–∞–Ω–∞
class DamageIndicator:
    def render_damage_flash(self, damage, viewport_width, viewport_height):
        """–ö—Ä–∞—Å–Ω–∞—è –≤—Å–ø—ã—à–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —É—Ä–æ–Ω–∞."""
        # –í—Ä–µ–º–µ–Ω–Ω–æ–µ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞ –∫—Ä–∞—Å–Ω—ã–º
        # + —Ç–µ–∫—Å—Ç –ø–æ —Ü–µ–Ω—Ç—Ä—É
        pass
```

#### 3.3. Culling –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–ø—Ä–∞–π—Ç–æ–≤

 **–§–∞–π–ª—ã** : `presentation/rendering/sprite_renderer_3d.py`

```python
def collect_sprites(self, level, fog_of_war=None, camera=None):
    """–°–æ–±–∏—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ —Å–ø—Ä–∞–π—Ç—ã."""
    sprites = []
  
    # –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π frustum culling
    if camera:
        fov_min_angle = camera.angle - camera.fov / 2
        fov_max_angle = camera.angle + camera.fov / 2
  
    for room in level.rooms:
        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–Ω–∞—Ç—ã –≤–Ω–µ FOV
        if camera and not self._room_in_fov(room, camera):
            continue
          
        for enemy in room.enemies:
            if not enemy.is_alive():
                continue
            # ... rest
```

#### 3.4. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è

 **–§–∞–π–ª—ã** : `config/game_config.py`

```python
class CameraConfig:
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è 3D –∫–∞–º–µ—Ä—ã."""
    GRID_CELL_SIZE = 1.0  # –†–∞–∑–º–µ—Ä –æ–¥–Ω–æ–π –∫–ª–µ—Ç–∫–∏ –≤ –º–∏—Ä–æ–≤—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö
    CAMERA_OFFSET = 0.5   # –°–º–µ—â–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã –æ—Ç —É–≥–ª–∞ –∫–ª–µ—Ç–∫–∏ (—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ)
    MOVE_SPEED = 1.0      # –°–∫–æ—Ä–æ—Å—Ç—å = 1 –∫–ª–µ—Ç–∫–∞ –∑–∞ —à–∞–≥
    ROTATION_SPEED = 15.0  # –≥—Ä–∞–¥—É—Å–æ–≤ –∑–∞ —à–∞–≥
    COLLISION_RADIUS = 0.3  # —Ä–∞–¥–∏—É—Å –∫–æ–ª–ª–∏–∑–∏–∏ –≤ –º–∏—Ä–æ–≤—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö
  
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
```

---

## –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ù–µ–¥–µ–ª—è 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. –î–µ–Ω—å 1-2: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π (1.1)
2. –î–µ–Ω—å 3-4: –î–≤–µ—Ä–∏ –≤ 3D (1.2)
3. –î–µ–Ω—å 5: –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è (1.3)
4. –î–µ–Ω—å 6-7: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã (1.4)

### –ù–µ–¥–µ–ª—è 2: –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. –î–µ–Ω—å 1-2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–π–∫–∞—Å—Ç–∏–Ω–≥–∞ (2.1)
2. –î–µ–Ω—å 3-4: –¢–µ–∫—Å—Ç—É—Ä—ã –¥–≤–µ—Ä–µ–π (2.2)
3. –î–µ–Ω—å 5: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (2.3)
4. –î–µ–Ω—å 6-7: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∏–Ω–∏–∫–∞—Ä—Ç—ã (2.4)

### –ù–µ–¥–µ–ª—è 3: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. –î–µ–Ω—å 1-2: –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ (3.1)
2. –î–µ–Ω—å 3-4: –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å (3.2)
3. –î–µ–Ω—å 5-6: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–ø—Ä–∞–π—Ç–æ–≤ (3.3)
4. –î–µ–Ω—å 7: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –µ–¥–∏–Ω–∏—Ü (3.4)

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã

**–§–∞–∑–∞ 1:**

* [ ] –ö–∞–º–µ—Ä–∞ –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ –≤—Å–µ–≥–¥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
* [ ] –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞—Å—Ç—Ä—è—Ç—å –≤ —Å—Ç–µ–Ω–µ
* [ ] –î–≤–µ—Ä–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è (locked/open)
* [ ] Reticle –º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤
* [ ] –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ –ª–æ–º–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –∫–∞–º–µ—Ä—ã

**–§–∞–∑–∞ 2:**

* [ ] FPS —Å—Ç–∞–±–∏–ª–µ–Ω –ø—Ä–∏ –Ω–µ–ø–æ–¥–≤–∏–∂–Ω–æ–π –∫–∞–º–µ—Ä–µ
* [ ] –¶–≤–µ—Ç–Ω—ã–µ –¥–≤–µ—Ä–∏ –≤–∏–∑—É–∞–ª—å–Ω–æ —Ä–∞–∑–ª–∏—á–∏–º—ã
* [ ] –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ F —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ
* [ ] –°—Ç—Ä–µ–ª–∫–∞ –º–∏–Ω–∏–∫–∞—Ä—Ç—ã –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–≤–æ—Ä–æ—Ç–µ

**–§–∞–∑–∞ 3:**

* [ ] –î–≤–∏–∂–µ–Ω–∏–µ –≤—ã–≥–ª—è–¥–∏—Ç –ø–ª–∞–≤–Ω–æ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
* [ ] –ü–æ–ª—É—á–µ–Ω–∏–µ —É—Ä–æ–Ω–∞ –≤–∏–∑—É–∞–ª—å–Ω–æ –∑–∞–º–µ—Ç–Ω–æ
* [ ] –ù–µ—Ç –ª–∞–≥–æ–≤ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –≤—Ä–∞–≥–æ–≤
* [ ] –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã
