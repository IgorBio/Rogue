# План рефакторинга (только обоснованные улучшения)

## Цель
Упростить проект без потери функциональности и без нарушения разделения слоёв.

## 1. Input: объединение 2D/3D обработчиков
**Почему обосновано:** дублирование логики, одинаковые схемы ввода, меньше точек ошибок.
**Что делать:**
- Объединить `presentation/input_handler.py` и `presentation/input/handler_3d.py` в один класс с режимом `2d/3d`.
- Оставить UI-тогглы (`toggle_*`) в presentation и возвращать их как отдельные события.

## 2. Position: оставить только доменную логику
**Почему обосновано:** Position — доменный объект, методы камеры относятся к presentation.
**Что делать:**
- Удалить из `domain/entities/position.py` методы `to_camera_coords`, `from_camera_coords` и любые camera-специфичные детали.
- Оставить минимальный набор методов, которые реально используются (distance, tuple, equality и т.д.).

## 3. Statistics: убрать неиспользуемые метрики
**Почему обосновано:** текущий Statistics содержит лишние поля и методы, которые не используются.
**Что делать:**
- Удалить только реально неиспользуемые метрики и методы.
- Проверить использование в коде и тестах перед удалением.

## 4. Rendering: частичное укрупнение, без монолитов
**Почему обосновано:** много мелких файлов, часть из них можно объединить без вреда.
**Что делать:**
- В 2D: объединить `renderer.py` и `ui_components.py` в один файл (например, `renderer_2d.py`).
- В 3D: оставить ключевые компоненты раздельно (raycasting/sprites/texture), не сваливать всё в один файл.

## 5. EventBus: упростить реализацию, но сохранить
**Почему обосновано:** EventBus нужен для разделения слоёв (domain → data), но текущая реализация может быть избыточной.
**Что делать:**
- Упростить внутреннюю реализацию EventBus (без лишних проверок и усложнений), сохранив API `subscribe/publish`.

## 6. Камера: сохранить ViewManager
**Почему обосновано:** ViewManager обеспечивает корректную изоляцию домена от presentation.
**Что делать:**
- Не удалять `presentation/view_manager.py`.
- Любые упрощения камеры делать внутри presentation-слоя, без возврата camera-полей в domain.

---

## Не делать (необоснованно/рискованно)
- Удаление `ActionType` — повышает риск строковых ошибок.
- Удаление `StateMachine` — теряется валидация переходов.
- Полное объединение domain-сервисов в один файл — ухудшит читаемость и поддержку.
- Удаление EventBus — нарушает разделение слоёв.
- Удаление ViewManager — вернёт domain → presentation связь.

---

## Порядок внедрения
1. Объединение input handlers.
2. Упрощение `Position`.
3. Чистка `Statistics`.
4. Частичное объединение рендеринга.
5. Упрощение `EventBus`.

## Проверки
- Прогон тестов после каждого шага.
- Проверка отсутствия доменных импортов из presentation/data.
