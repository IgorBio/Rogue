# План исправлений (только обоснованные проблемы)

Ниже перечислены только те проблемы, которые подтверждаются текущим кодом и влияют на стабильность или корректность.

## 1. Логирование ошибок подписчиков EventBus
**Проблема:** `domain/event_bus.py` подавляет исключения в `publish()` без логирования.  
**Риск:** ошибки подписчиков остаются невидимыми, что ломает диагностику.  
**Исправление:**
- Подключить `log_exception` в `domain/event_bus.py`.
- В `publish()` логировать исключение вместе с контекстом (`event` и callback).

**Критерий готовности:** ошибки подписчиков отражаются в логах, поведение EventBus не ломает остальных подписчиков.

## 2. Автосейв молча проваливается
**Проблема:** в `domain/services/level_manager.py` автосейв игнорирует ошибки ввода-вывода.  
**Риск:** игрок не знает, что прогресс не сохранён.  
**Исправление:**
- Логировать исключение (через `log_exception`).
- Добавлять игроку предупреждение в `session.message`.

**Критерий готовности:** при сбое автосейва появляется предупреждение, ошибка фиксируется в логах.

## 3. Хрупкая десериализация состояния GameState
**Проблема:** `data/save_manager.py` восстанавливает состояние по флагам `victory/game_over/player_asleep`.  
**Риск:** при добавлении новых состояний восстановление станет некорректным.  
**Исправление:**
- При сохранении добавлять `game_state = state_machine.current_state.name`.
- При загрузке восстанавливать состояние по имени (с fallback на `PLAYING` при ошибках).

**Критерий готовности:** состояние корректно восстанавливается из сохранения, независимо от комбинации флагов.

## 4. Хардкод размеров 3D viewport
**Проблема:** `presentation/renderer_3d.py` использует фиксированные размеры (70x20).  
**Риск:** плохая адаптация под терминал, возможный выход за границы.  
**Исправление:**
- Получать размеры через `stdscr.getmaxyx()`.
- Ограничить viewport по доступной площади (например, `min(70, max_x - padding)`).

**Критерий готовности:** 3D рендер адаптируется под размер терминала без ошибок curses.

---

## Порядок выполнения
1. Исправить EventBus (логирование исключений).
2. Исправить автосейв (лог + предупреждение игроку).
3. Исправить сериализацию GameState.
4. Адаптировать размеры 3D viewport.
