# План исправления (только обоснованные проблемы)

Ниже перечислены только подтвержденные проблемы 3D-составляющей с краткой стратегией исправления.

## 1) Отсутствует различение состояния дверей в 3D (open/locked)

**Почему это проблема:**
- В `presentation/rendering/raycasting.py` `_determine_wall_type()` возвращает только `door`, без состояния.
- В `presentation/renderer_3d.py` двери получают тот же цвет/тип, что и обычные стены.
- В `presentation/rendering/texture_system.py` есть текстуры `door` и `locked_door`, но выбор между ними не происходит.

**Стратегия исправления:**
- Расширить `RayHit`/`_determine_wall_type()` так, чтобы возвращать состояние двери (`door_open`/`door_locked`) или передавать объект двери.
- В `Renderer3D` выбирать соответствующую текстуру/символ и цвет для open/locked.
- Обновить логику отображения (цвет/символ/текстура) так, чтобы locked визуально отличались от open.

**Критерии приемки:**
- Закрытые двери визуально отличаются от открытых.
- Отображение корректно при разных цветах/ключах, если используется окраска.

## 2) Некорректные приоритеты взаимодействия в 3D (F/Space)

**Почему это проблема:**
- В `domain/services/action_processor.py::_handle_3d_interact()` приоритет: враг → предмет → выход → дверь.
- Если дверь находится перед врагом, дверь нельзя открыть, хотя она должна быть доступна для взаимодействия.

**Стратегия исправления:**
- Ввести явный приоритет: дверь → враг → предмет → выход → ничего.
- Вынести проверку двери в начало и только при отсутствии двери продолжать обработку других объектов.
- При необходимости уточнить детект двери через `camera_controller` (дистанция/направление).

**Критерии приемки:**
- Двери корректно открываются даже при наличии врага в той же линии взгляда.
- Поведение F/Space становится предсказуемым и стабильным.

## 3) Слабая визуальная индикация взаимодействия (reticle)

**Почему это проблема:**
- В `presentation/game_ui.py` reticle переключается только для врагов (`set_locked(entity_type == 'enemy')`).
- Двери/предметы/выход не дают визуальной обратной связи, хотя являются интерактивными объектами.

**Стратегия исправления:**
- Расширить `TargetingReticle` для поддержки типа цели (`enemy`, `item`, `door`, `exit`, `none`).
- В `GameUI` выставлять тип цели на основе данных от `camera_controller.get_entity_in_front()` и проверки двери.
- Для каждого типа задать отдельный символ/цвет (минимально: разные цвета).

**Критерии приемки:**
- Reticle визуально меняется при наведении на дверь/предмет/выход.
- Поведение однозначно и устойчиво во всех 3D-сценариях.
